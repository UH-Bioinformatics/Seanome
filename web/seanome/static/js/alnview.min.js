var MSA;function draw(a){drawMSA(a);drawTable(a)}function drawMSA(d){$("#msaParent").html("<div id='msa'></div>");if((!$("#aln").val())||(!$("input[name=clean]:checked").val())){return}var a=d+"/ajax/msa/"+$("#aln").val()+$("input[name=clean]:checked").val()+"/";var c={};c.el=document.getElementById("msa");c.el.textContent="loading";c.vis={conserv:false,overviewbox:false,labelId:false};c.zoomer={boxRectHeight:1,boxRectWidth:1,labelWidth:210,labelIdLength:0,alignmentWidth:940,alignmentHeight:330,residueFont:"18px mono monospace",labelFontsize:"9px",labelLineHeight:"30px",markerFontsize:"16px",columnWidth:30,rowHeight:20};biojs.io.fasta.parse.read(a,function(e){e.forEach(function(g){g.name=$.trim(g.name);var f=g.name.indexOf(" ");if(f!=-1){g.name=g.name.substring(0,f)}else{if(g.name.length>22){g.name=g.name.substring(0,22)}}});c.seqs=e;c.speed=true;c.keyevents=true;c.visibleElements={ruler:false};MSA=new biojs.vis.msa.msa(c);MSA.el.style.marginTop="10px";MSA.render();MSA.g.off("residue:click");MSA.g.off("row:click");MSA.g.off("column:click")})}function gotopos(a){MSA.g.zoomer.setLeftOffset(a)}function drawTable(a){$("#snpParent").html("");if($("input[name=clean]:checked").val()!=1){return}url=a+"/ajax/snp/"+$("#aln").val();$.get(url,function(d){if(d.length==0){return}var c=Object.keys(d[0].counts),e="<tr><th>Position</th><th>Reference</th><th>Alternate(s)</th>";html="<table id='snptbl' class ='table table-striped table-bordered'>";c.forEach(function(f){e+="<th><div class='row' style='width:300px'><span class='col-md-12 text-center'>"+f+"</span></div><div class='row'><div class='col-md-6 text-center'>Allele Freq.</div><div class='col-md-6 text-center'>Counts</div></div></th>"});e+="</tr>";html+="<thead>"+e+"</thead><tfoot>"+e+"</tfoot><tbody>";d.forEach(function(f){html+="<tr><td style='cursor:pointer;' onclick='gotopos(\""+(f.pos-1)+"\");'>"+f.pos+"</td><td>"+f.ref+"</td><td>"+f.alts.join(", ")+"</td>";MSA.g.selcol.add(new biojs.vis.msa.selection.columnsel({xStart:f.pos-1,xEnd:f.pos-1}));c.forEach(function(g){var j=[];var i=0;for(b in f.counts[g]){j.push(b+": "+f.counts[g][b]);i+=f.counts[g][b]}var h=[];for(b in f.counts[g]){h.push(b+": "+((i!=0)?(f.counts[g][b]/i).toFixed(3):"0.000"))}html+="<td><div class='row' style='width:300px'><div class='col-md-6 text-center'>"+h.join("<br />")+"</div><div class='col-md-6 text-center'>"+j.join("<br />")+"</div></div></td>"});html+="</tr>"});html+="</tbody></table>";$("#snpParent").html(html);$("#snptbl").dataTable({dom:"Rlfrtip",iDisplayLength:10,scrollX:true})},"json")};