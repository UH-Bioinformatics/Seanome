var MSA;var Fasta=require("biojs-io-fasta");function buildAlignSelector(d,a,c,e){$("#tbldat").html('<table cellpadding="0" cellspacing="0" border="0" class="display" id="tabledat"></table>');d.forEach(function(f){f[2]=((f[2]==1)?"Yes":"No")});$("#tabledat").dataTable({order:[[2,"desc"]],pageLength:5,lengthChange:false,data:d,columns:[{title:"file id"},{title:"File name"},{title:"Has SNPs?"}],columnDefs:[{targets:[0],visible:false,searchable:false}],fnRowCallback:function(i,h,g,f){$("td:eq(0)",i).html(c+"_"+h[1])}});$("#tabledat tbody").on("click","tr",function(g){var f=$("#tabledat").dataTable().fnGetData(this);key=a+"/"+f[0]+"/";draw(key,e)})}function draw(a,c){drawMSA(a,c);drawTable(a,c);$("#disinfo").val(a)}function compare(d,c){if(d.name=="Consensus"){return -1}return d.name.localeCompare(c.name)}function drawMSA(c,e){$("#msaParent").html("<div id='msa'></div>");if(!(c)||!$("input[name=clean]:checked").val()){return}var a=e+"/ajax/msa/"+c+$("input[name=clean]:checked").val()+"/";var d={};d.el=document.getElementById("msa");d.el.textContent="loading";d.vis={conserv:false,overviewbox:false,labelId:false};d.zoomer={boxRectHeight:1,boxRectWidth:1,labelWidth:100,labelIdLength:0,labelNameLength:200,alignmentWidth:940,alignmentHeight:200,residueFont:"16px mono monospace",labelFontsize:"9px",labelLineHeight:"30px",markerFontsize:"16px",columnWidth:30,rowHeight:20};Fasta.read(a,function(f,g){g.forEach(function(i){i.name=$.trim(i.name);var h=i.name.indexOf("_");if(h!=-1){i.name=i.name.substring(h+1)}else{if(i.name.length>22){i.name=i.name.substring(0,22)}}});d.zoomer.alignmentHeight=Math.min(20*g.length,200);d.seqs=g;d.speed=true;d.keyevents=true;d.visibleElements={ruler:false};MSA=new biojs.vis.msa.msa(d);MSA.el.style.marginTop="10px";MSA.render();MSA.g.off("residue:click");MSA.g.off("row:click");MSA.g.off("column:click")})}function gotopos(a){MSA.g.zoomer.setLeftOffset(a)}function drawTable(a,c){$("#snpParent").html("");if($("input[name=clean]:checked").val()!=1){return}url=c+"/ajax/snp/"+a;$.get(url,function(e){if(e.length==0){return}var d=Object.keys(e[0].counts),f="<tr><th>Position</th><th>Reference</th><th>Alternate(s)</th>";html="<table id='snptbl' class ='table table-striped table-bordered'>";d.forEach(function(g){f+="<th><div class='row' style='width:300px'><span class='col-md-12 text-center'>"+g+"</span></div><div class='row'><div class='col-md-6 text-center'>Allele Freq.</div><div class='col-md-6 text-center'>Counts</div></div></th>"});f+="</tr>";html+="<thead>"+f+"</thead><tfoot>"+f+"</tfoot><tbody>";e.forEach(function(g){html+="<tr><td style='cursor:pointer;' onclick='gotopos(\""+(g.pos-1)+"\");'>"+g.pos+"</td><td>"+g.ref+"</td><td>"+g.alts.join(", ")+"</td>";d.forEach(function(h){var l=[];var j=0;for(b in g.counts[h]){l.push(b+": "+g.counts[h][b]);j+=g.counts[h][b]}var i=[];for(b in g.counts[h]){i.push(b+": "+((j!=0)?(g.counts[h][b]/j).toFixed(3):"0.000"))}html+="<td><div class='row' style='width:300px'><div class='col-md-6 text-center'>"+i.join("<br />")+"</div><div class='col-md-6 text-center'>"+l.join("<br />")+"</div></div></td>"});html+="</tr>"});html+="</tbody></table>";$("#snpParent").html(html);$("#snptbl").dataTable({dom:"Rlfrtip",iDisplayLength:10,scrollX:true})},"json")};