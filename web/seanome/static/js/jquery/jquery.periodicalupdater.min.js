(function(a){a.PeriodicalUpdater=function(c,b,d){if(!b){b={}}var q=jQuery.extend(true,{url:c,cache:false,method:"GET",data:"",minTimeout:1000,maxTimeout:64000,multiplier:2,maxCalls:0,autoStop:0,autoStopCallback:null,cookie:false,runatonce:false,verbose:0},b);var g=function(w,u){u=u||1;if(q.verbose>=u){try{console.log(w)}catch(v){}}};var h=null;var o=null;var t=null;var l=q.minTimeout;var p=q.maxCalls;var j=q.autoStop;var k=0;var m=0;var n=p;var i=function(u){a(function(){if(h!==null){clearTimeout(h)}l=u;g("resetting timer to "+l+".",2);if(q.cookie&&a.cookie){a.cookie(q.cookie.name,l,q.cookie)}h=setTimeout(e,l)})};var s=function(){if(q.multiplier>1){var u=l;l=l*q.multiplier;if(l>q.maxTimeout){l=q.maxTimeout}g("adjusting timer from "+u+" to "+l+".",2)}i(l)};if(q.cookie){if(typeof(q.cookie)=="boolean"){q.cookie={name:c}}else{if(typeof(q.cookie)!="object"){q.cookie={name:q.cookie.toString()}}}if(!q.cookie.name){q.cookie.name=c}if(!a.cookie){a.getScript("https://raw.github.com/carhartl/jquery-cookie/master/jquery.cookie.js",function(){g("Loaded the cookies handler script",2);if(a.cookie(q.cookie.name)){g("Not runatonce and have cookie value",2);i(a.cookie(q.cookie.name))}else{g("Not runatonce, but no cookie value",2);i(l)}}).fail(function(){g("Could not load the cookies handler script",1);i(l)})}else{if(a.cookie(q.cookie.name)){i(a.cookie(q.cookie.name))}}}var f=jQuery.extend(true,{},q);if(q.type&&!f.dataType){f.dataType=q.type}if(q.sendData){f.data=q.sendData}f.type=q.method;f.ifModified=true;function e(v){var u=jQuery.extend(true,{},f);if(typeof(b.data)=="function"){u.data=b.data()}if(u.data){if(typeof(u.data)=="number"){u.data=u.data.toString()}}if(v||p===0){g("Sending data");a(function(){a.ajax(u)})}else{if(p>0&&k<p){g("Sending data because we are at "+k+" of "+p+" calls");a(function(){a.ajax(u)});k++}else{if(p==-1){g("NOT sending data: stop has been called",1)}else{g("NOT sending data: maximum number of calls reached - "+p,1)}}}}var r={boostTimer:function(u){if(u>0&&u!=1){g("Boosting timer by a factor of "+u);l=l*u}else{g("Cannot boost timer by a factor of "+u)}i(l);return},restart:function(u){g("Calling restart");p=n;k=0;m=0;i(u||l);return},send:function(){g("Explicit call to send");e(true);return},stop:function(){g("Calling stop");p=-1;if(q.cookie&&a.cookie){a.cookie(q.cookie.name,null,q.cookie)}return}};f.success=function(u){g("Successful run! (In 'success')",2);o=u};f.complete=function(v,u){g("Status of call: "+u+" (In 'complete')",2);if(u=="success"||u=="notmodified"){var w=a.trim(v.responseText);if(t==w){if(j>0){m++;if(m==j){r.stop();if(q.autoStopCallback){q.autoStopCallback(m)}return}}s()}else{m=0;i(q.minTimeout);t=w;if(q.cookie){a.cookie(q.cookie.name,t,q.cookie)}if(o===null){o=w}if((f.dataType==="json")&&(typeof(o)==="string")&&(u=="success")){o=JSON.parse(o)}if(q.success){q.success(o,u,v,r)}if(d){d(o,u,v,r)}}}if(q.complete){q.complete(v,u)}o=null};f.error=function(u,v){g("Error message: "+v+" (In 'error')",2);if(v!="notmodified"){t=null;if(q.cookie){a.cookie(q.cookie.name,null,q.cookie)}i(q.minTimeout)}if(q.error){q.error(u,v)}};if(q.runatonce){g("Executing a call immediately",1);e(true)}else{if(a.cookie&&q.cookie&&a.cookie(q.cookie.name)){}else{g("Enqueing a the call for after "+l,1);i(l)}}return r};a.fn.PeriodicalUpdater=function(c,b,e){var d=this;return a.PeriodicalUpdater(c,b,function(){return e.apply(d,arguments)})}})(jQuery);